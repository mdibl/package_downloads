#!/bin/sh

# Organization: MDIBL
# Author: Lucie Hutchins
# Date: October 2017
## Script to build and install a new package

cd `dirname $0`

SCRIPT_NAME=`basename $0`
WORKING_DIR=`pwd`

echo "==" 
echo "Install Directory: ${PACKAGE_BASE} "
echo "Server Name: `uname -n`" 
echo "Install Date: `date`" 
echo "=="
if [ ! -d ${PACKAGE_BASE} ]
then
   echo "ERROR:Install directory does not exist. See ${PACKAGE_BASE}" 
   exit 1
fi
if [ "${SOFTWARE_BASE}" = "" ]
then
   echo "ERROR: global variable SOFTWARE_BASE not set" 
   exit 1
fi
dependency_file=`basename ${PACKAGE_DEPENDS}`
if [ ! -f ${dependency_file} ]
then
    echo "ERROR: ${dependency_file} missing from `pwd`"
    exit 1
fi
source ./${dependency_file}
rstatus="SUCCESS"
#Copy the binaries to /opt/software/bin
#
for bin_file in ${FILE_CHECK}
do
    if [ ! -f ${PACKAGE_BASE}/${bin_file} ]
    then
        echo "${PACKAGE_BASE}/${bin_file} missing"
        rstatus="FAILED"
    else
        chmod 755 ${PACKAGE_BASE}/${bin_file}
        cp -p  ${PACKAGE_BASE}/${bin_file} ${SOFTWARE_BASE}/bin/
    fi
done
echo "${rstatus}" 
[ "${rstatus}" == FAILED ] && exit 1

exit 0

